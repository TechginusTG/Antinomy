<!DOCTYPE html>
<html lang="ko">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>ê³„íš ë„ìš°ë¯¸</title>
Â  <style>
Â  Â  /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
Â  Â  * { box-sizing: border-box; }
Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  display: flex;
Â  Â  Â  height: 100vh;
Â  Â  Â  background-color: #f3f4f6;
Â  Â  Â  overflow: hidden;
Â  Â  }
Â  Â  #chat {
Â  Â  Â  width: 40%; max-width: 400px; min-width: 280px;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  border-right: 1px solid #ccc;
Â  Â  Â  display: flex; flex-direction: column;
Â  Â  Â  background-color: #ffffff;
Â  Â  Â  position: relative; z-index: 2;
Â  Â  Â  border-radius: 0 20px 20px 0;
Â  Â  }
Â  Â  #chat.collapsed {
Â  Â  Â  width: 0;
Â  Â  Â  min-width: 0;
Â  Â  Â  overflow: hidden;
Â  Â  Â  border: none;
Â  Â  }
Â  Â  #chat.collapsed + #openChatButton { display: block; }
Â  Â  #chat h2 { color: #333; margin: 16px; }
Â  Â  #chatLog { flex: 1; overflow-y: auto; margin: 0 16px 8px 16px; }
Â  Â  #chatInputArea {
Â  Â  Â  display: flex; align-items: center;
Â  Â  Â  padding: 12px 16px;
Â  Â  Â  border-top: 1px solid #ddd;
Â  Â  Â  background-color: #f9fafb;
Â  Â  }
Â  Â  #userInput {
Â  Â  Â  flex: 1; resize: none; padding: 10px 12px;
Â  Â  Â  font-size: 14px; border: 1px solid #ccc;
Â  Â  Â  border-radius: 10px; height: 40px;
Â  Â  Â  overflow-y: hidden;
Â  Â  }
Â  Â  #sendBtn {
Â  Â  Â  margin-left: 8px; padding: 10px 16px;
Â  Â  Â  background-color: #2563eb; color: white;
Â  Â  Â  border: none; border-radius: 10px;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  #toggleChat {
Â  Â  Â  position: absolute; top: 16px; left: 100%;
Â  Â  Â  transform: translateX(-100%);
Â  Â  Â  background-color: #2563eb; color: white;
Â  Â  Â  border: none; padding: 6px 12px;
Â  Â  Â  cursor: pointer; border-radius: 0 10px 10px 0;
Â  Â  }
Â  Â  #openChatButton {
Â  Â  Â  display: none; position: absolute; top: 20px; left: 10px; z-index: 3;
Â  Â  Â  background-color: #2563eb; color: white;
Â  Â  Â  padding: 8px 14px; border: none; border-radius: 10px;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  #diagram {
Â  Â  Â  flex-grow: 1;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  position: relative;
Â  Â  Â  background-color: #fafafa;
Â  Â  Â  overflow: auto;
Â  Â  Â  padding: 20px; /* ê¸°ì¡´ padding ìœ ì§€ */
Â  Â  Â  border-radius: 20px 0 0 0;
Â  Â  Â  display: flex; /* Flexbox ì¶”ê°€ */
Â  Â  Â  flex-direction: column; /* ì„¸ë¡œ ì •ë ¬ */
Â  Â  }
Â  Â  #diagramContent {
Â  Â  Â  flex-grow: 1; /* ë‚¨ì€ ê³µê°„ ì°¨ì§€ */
Â  Â  Â  border: 2px dashed #bbb;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  padding: 40px;
Â  Â  Â  text-align: center;
Â  Â  Â  font-size: 18px;
Â  Â  Â  color: #555;
Â  Â  Â  margin-top: 60px; /* ëª©í‘œ ë³´ê¸° ë²„íŠ¼ê³¼ì˜ ê°„ê²© ìœ ì§€ */
Â  Â  Â  white-space: pre-wrap;
Â  Â  Â  margin-bottom: 20px; /* export ë²„íŠ¼ê³¼ì˜ ê°„ê²© í™•ë³´ */
Â  Â  }
Â  Â  .response-box {
Â  Â  Â  background-color: #e0e7ff;
Â  Â  Â  border: 2px solid #4f46e5;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  padding: 16px;
Â  Â  Â  margin-bottom: 16px;
Â  Â  Â  max-width: 70%; word-wrap: break-word;
Â  Â  Â  box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
Â  Â  }
Â  Â  .response-box.user {
Â  Â  Â  background-color: #fef3c7;
Â  Â  Â  border: 2px solid #f59e0b;
Â  Â  Â  margin-left: auto;
Â  Â  }
Â  Â  .response-box.gpt {
Â  Â  Â  background-color: #e0e7ff;
Â  Â  Â  border: 2px solid #4f46e5;
Â  Â  Â  margin-right: auto;
Â  Â  }
Â  Â  #goalBox {
Â  Â  Â  position: absolute; top: 16px; right: 16px;
Â  Â  Â  background-color: #2563eb; color: white;
Â  Â  Â  padding: 10px 16px;
Â  Â  Â  border-radius: 20px; cursor: pointer;
Â  Â  Â  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
Â  Â  Â  z-index: 1;
Â  Â  }
Â  Â  #goalModal {
Â  Â  Â  position: absolute; top: 60px; right: 16px;
Â  Â  Â  background-color: white;
Â  Â  Â  border: 1px solid #ccc; border-radius: 16px;
Â  Â  Â  padding: 16px; width: 300px;
Â  Â  Â  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
Â  Â  Â  display: none; z-index: 10;
Â  Â  Â  color: #333;
Â  Â  }
Â  Â  #goalModal ul { padding-left: 20px; }
Â  Â  #goalModal ul li { margin-bottom: 6px; }
Â  Â  #summarizedGoalContent {
Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  padding-top: 10px;
Â  Â  Â  Â  border-top: 1px dashed #eee;
Â  Â  Â  Â  font-size: 0.95em;
Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  white-space: pre-wrap;
Â  Â  }
Â  Â  #exportBtn {
Â  Â  Â  /* position: absolute; */ /* Flexboxë¡œ ì¸í•´ í•„ìš” ì—†ì–´ì§ */
Â  Â  Â  align-self: flex-end; /* ì˜¤ë¥¸ìª½ ì•„ë˜ ì •ë ¬ */
Â  Â  Â  margin-top: auto; /* ë‚¨ì€ ê³µê°„ì„ ë°€ì–´ë‚´ì„œ ì•„ë˜ë¡œ ë°°ì¹˜ */
Â  Â  Â  margin-right: 0px; /* ê¸°ì¡´ right ê°’ë§Œí¼ ì¡°ì • */
Â  Â  Â  margin-bottom: 0px; /* ê¸°ì¡´ bottom ê°’ë§Œí¼ ì¡°ì • */
Â  Â  Â  background-color: #10b981; color: white;
Â  Â  Â  padding: 10px 16px; border: none;
Â  Â  Â  border-radius: 12px; cursor: pointer;
Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
Â  Â  Â  z-index: 1; /* íŒì—…ë³´ë‹¤ ì•„ë˜ë¡œ ì˜¤ì§€ ì•Šë„ë¡ z-index ì¡°ì • */
Â  Â  }

Â  Â  /* íŒì—… ìŠ¤íƒ€ì¼ ì¡°ì • */
Â  Â  #gptResponsePopup {
Â  Â  Â  display: none;
Â  Â  Â  position: absolute;
Â  Â  Â  background-color: #ffffff;
Â  Â  Â  border: 3px solid #2563eb;
Â  Â  Â  border-radius: 15px;
Â  Â  Â  padding: 10px; /* íŒì—…ì°½ ì „ì²´ì˜ ë‚´ë¶€ ì—¬ë°± ìœ ì§€ */
Â  Â  Â  max-width: calc(100% / 3 * 2);
Â  Â  Â  width: fit-content;
Â  Â  Â  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
Â  Â  Â  z-index: 100;
Â  Â  Â  text-align: left;
Â  Â  Â  font-size: 1.1em;
Â  Â  Â  color: #333;
Â  Â  Â  cursor: grab;
Â  Â  Â  top: 50%;
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  word-wrap: break-word;
Â  Â  Â  white-space: pre-wrap;
Â  Â  Â  transition: all 0.3s ease; /* ì¶•ì†Œ/í™•ëŒ€ ì• ë‹ˆë©”ì´ì…˜ */
Â  Â  }

Â  Â  #gptResponsePopup.minimized {
Â  Â  Â  width: 50px;
Â  Â  Â  height: 50px;
Â  Â  Â  padding: 0;
Â  Â  Â  border-radius: 50%; /* ì›í˜• ë²„íŠ¼ */
Â  Â  Â  overflow: hidden; /* ë‚´ìš© ìˆ¨ê¸°ê¸° */
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-size: 0; /* í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸° */
Â  Â  Â  background-color: #2563eb;
Â  Â  Â  border-color: #1a4d9f;
Â  Â  Â  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
Â  Â  }

Â  Â  #gptResponsePopup.minimized .popup-header,
Â  Â  #gptResponsePopup.minimized .popup-content,
Â  Â  #gptResponsePopup.minimized #minimizePopupButton {
Â  Â  Â  display: none; /* ì¶•ì†Œ ì‹œ ë‚´ë¶€ ìš”ì†Œ ìˆ¨ê¹€ */
Â  Â  }

Â  Â  #gptResponsePopup.minimized::after {
Â  Â  Â  content: 'ğŸ’¬'; /* ë²„íŠ¼ìœ¼ë¡œ ì¶•ì†Œë˜ì—ˆì„ ë•Œ ì•„ì´ì½˜ í‘œì‹œ */
Â  Â  Â  font-size: 24px;
Â  Â  Â  color: white;
Â  Â  Â  display: block;
Â  Â  }


Â  Â  #gptResponsePopup .popup-header {
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin-bottom: 5px; /* í—¤ë”ì™€ ë‚´ìš© ì‚¬ì´ ê°„ê²© ìœ ì§€ */
Â  Â  Â  color: #2563eb;
Â  Â  Â  font-size: 1.2em;
Â  Â  Â  cursor: grab;
Â  Â  }

Â  Â  #gptResponsePopup .popup-content {
Â  Â  Â  margin-top: 0;
Â  Â  Â  line-height: 1.3;
Â  Â  Â  max-height: 75px; /* íŒì—… ë‚´ìš© ì˜ì—­ì˜ ìµœëŒ€ ë†’ì´ë¥¼ 75pxë¡œ ì¤„ì„ */
Â  Â  Â  overflow-y: auto;
Â  Â  }

Â  Â  @keyframes fadeIn {
Â  Â  Â  from { opacity: 0; transform: translate(-50%, -60%); }
Â  Â  Â  to { opacity: 1; transform: translate(-50%, -50%); }
Â  Â  }

Â  Â  #minimizePopupButton {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 5px;
Â  Â  Â  right: 5px;
Â  Â  Â  background: none;
Â  Â  Â  border: none;
Â  Â  Â  font-size: 20px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  color: #666;
Â  Â  Â  line-height: 1;
Â  Â  Â  padding: 0;
Â  Â  }
Â  </style>
</head>
<body>
Â  <div id="chat">
Â  Â  <button id="toggleChat" onclick="toggleChat()">â—€</button>
Â  Â  <h2>ChatGPT ëŒ€í™”ì°½</h2>
Â  Â  <div id="chatLog">
Â  Â  Â  <div class="response-box user">
Â  Â  Â  Â  <strong>ì‚¬ìš©ì:</strong> ì¼ë³¸ ì—¬í–‰ì„ ê°€ê¸° ìœ„í•œ ìˆœì„œë„ë¥¼ ë§Œë“¤ê³  ì‹¶ì–´ìš”. ì–´ë–¤ ë‹¨ê³„ë¶€í„° ì‹œì‘í•´ì•¼ í• ê¹Œìš”?
Â  Â  Â  </div>
Â  Â  Â  <div class="response-box gpt">
Â  Â  Â  Â  <strong>ChatGPT:</strong> ì¼ë³¸ ì—¬í–‰ ìˆœì„œë„ë¥¼ ë§Œë“¤ë ¤ë©´ ë¨¼ì € **'ì—¬í–‰ ëª©í‘œ ë° ì˜ˆì‚° ì„¤ì •'**ë¶€í„° ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì—¬í–‰ì˜ í° ê·¸ë¦¼ì„ ê·¸ë¦´ ìˆ˜ ìˆì–´ìš”.
Â  Â  Â  </div>
Â  Â  Â  <div class="response-box user">
Â  Â  Â  Â  <strong>ì‚¬ìš©ì:</strong> ì¢‹ìŠµë‹ˆë‹¤! ì—¬í–‰ ëª©í‘œì™€ ì˜ˆì‚°ì„ ì„¤ì •í•œ í›„ì—ëŠ” ì–´ë–¤ ë‹¨ê³„ë¥¼ ê³ ë ¤í•´ì•¼ í• ê¹Œìš”?
Â  Â  Â  </div>
Â  Â  Â  <div class="response-box gpt">
Â  Â  Â  Â  <strong>ChatGPT:</strong> ë‹¤ìŒìœ¼ë¡œëŠ” **'í•­ê³µê¶Œ ë° ìˆ™ì†Œ ì˜ˆì•½'** ë‹¨ê³„ë¥¼ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ì—¬í–‰ ë‚ ì§œì™€ ì²´ë¥˜ ê¸°ê°„ì„ í™•ì •í•˜ê³ , ì´ì— ë§ì¶° í•­ê³µê¶Œê³¼ ìˆ™ì†Œë¥¼ ë¯¸ë¦¬ ì˜ˆì•½í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”.
Â  Â  Â  </div>
Â  Â  Â  <div class="response-box user">
Â  Â  Â  Â  <strong>ì‚¬ìš©ì:</strong> í•­ê³µê¶Œ, ìˆ™ì†Œ ì˜ˆì•½ê¹Œì§€ ì™„ë£Œí–ˆë‹¤ë©´ ê·¸ë‹¤ìŒì€ ë¬´ì—‡ì„ í•´ì•¼ í• ê¹Œìš”?
Â  Â  Â  </div>
Â  Â  Â  <div class="response-box gpt" id="lastResponse">
Â  Â  Â  Â  <strong>ChatGPT:</strong> ì´ì œ ì—¬í–‰ì˜ êµ¬ì²´ì ì¸ ê³„íšì„ ì„¸ìš¸ ì°¨ë¡€ì…ë‹ˆë‹¤. **'ì„¸ë¶€ ì¼ì • ê³„íš ë° í˜„ì§€ ì •ë³´ ì¡°ì‚¬'** ë‹¨ê³„ë¥¼ ì‹œì‘í•˜ì„¸ìš”. ë°©ë¬¸í•  ì¥ì†Œ, êµí†µí¸, ë§›ì§‘ ë“±ì„ ìƒì„¸íˆ ì¡°ì‚¬í•˜ê³  ì¼ì •ì„ í™•ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="chatInputArea">
Â  Â  Â  <textarea id="userInput" placeholder="ê³„íšì´ë‚˜ ëª©í‘œì— ëŒ€í•´ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
Â  Â  Â  <button id="sendBtn" onclick="sendChatMessage()">ì…ë ¥</button>
Â  Â  </div>
Â  </div>

Â  <button id="openChatButton" onclick="toggleChat()">GPT ì—´ê¸°</button>

Â  <div id="diagram">
Â  Â  <div id="goalBox" onclick="toggleGoalModal()">ğŸ¯ ëª©í‘œ ë³´ê¸°</div>
Â  Â  <div id="goalModal">
Â  Â  Â  <h3>ë‚´ ëª©í‘œ</h3>
Â  Â  Â  <p><strong>ì˜ˆì‹œ:</strong> "7ì›” ë‚´ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ ì™„ì„±"</p>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li>1ë‹¨ê³„: ì•„ì´ë””ì–´ êµ¬ìƒ</li>
Â  Â  Â  Â  <li>2ë‹¨ê³„: ê¸°ëŠ¥ ëª©ë¡ ì‘ì„±</li>
Â  Â  Â  Â  <li>3ë‹¨ê³„: ë””ìì¸ ë° ê°œë°œ</li>
Â  Â  Â  Â  <li>4ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë° ë°°í¬</li>
Â  Â  Â  </ul>
Â  Â  Â  <div id="summarizedGoalContent">
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="diagramContent">
Â  Â  Â  drawioíŒŒì¼ì„ ë„ìš°ê¸°ìœ„í•œ í™”ë©´
Â  Â  </div>

Â  Â  <div id="gptResponsePopup">
Â  Â  Â  <button id="minimizePopupButton" onclick="togglePopupMinimize(event)">â€“</button>
Â  Â  Â  <div class="popup-header">ChatGPT ë‹µë³€</div>
Â  Â  Â  <div class="popup-content" id="popupResponseContent"></div>
Â  Â  </div>

Â  Â  <button id="exportBtn" onclick="exportToXML()">XML íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
Â  </div>

Â  <script>
Â  Â  const gptResponsePopup = document.getElementById('gptResponsePopup');
Â  Â  let isDragging = false;
Â  Â  let offsetX, offsetY;

Â  Â  function toggleGoalModal() {
Â  Â  Â  const goalModal = document.getElementById('goalModal');
Â  Â  Â  goalModal.style.display = goalModal.style.display === 'block' ? 'none' : 'block';
Â  Â  Â  if (goalModal.style.display === 'block') {
Â  Â  Â  Â  updateGoalSummary();
Â  Â  Â  }
Â  Â  }

Â  Â  function toggleChat() {
Â  Â  Â  const chat = document.getElementById('chat');
Â  Â  Â  const openBtn = document.getElementById('openChatButton');
Â  Â  Â  const diagram = document.getElementById('diagram');
Â  Â  Â  const lastResponseElement = document.getElementById('lastResponse');
Â  Â  Â  const popupResponseContent = document.getElementById('popupResponseContent');

Â  Â  Â  const isCollapsed = chat.classList.toggle('collapsed');
Â  Â  Â  
Â  Â  Â  openBtn.style.display = isCollapsed ? 'block' : 'none';
Â  Â  Â  diagram.style.flexGrow = isCollapsed ? 2 : 1;

Â  Â  Â  if (isCollapsed) {
Â  Â  Â  Â  if (lastResponseElement) {
Â  Â  Â  Â  Â  const lastGptText = lastResponseElement.textContent.replace('ChatGPT:', '').trim();
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // ê³µë°± ì²˜ë¦¬ ë¡œì§ (ì˜µì…˜ 1)
Â  Â  Â  Â  Â  const cleanedGptText = lastGptText.trim().replace(/\n{2,}/g, '\n').replace(/\t/g, ' ');

Â  Â  Â  Â  Â  popupResponseContent.textContent = cleanedGptText; 
Â  Â  Â  Â  Â  gptResponsePopup.style.display = 'block';
Â  Â  Â  Â  Â  gptResponsePopup.style.top = '50%';
Â  Â  Â  Â  Â  gptResponsePopup.style.left = '50%';
Â  Â  Â  Â  Â  gptResponsePopup.style.transform = 'translate(-50%, -50%)';
Â  Â  Â  Â  Â  gptResponsePopup.classList.remove('minimized'); // ì¶•ì†Œëœ ìƒíƒœ í•´ì œ
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  popupResponseContent.textContent = "ë§ˆì§€ë§‰ ChatGPT ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤.";
Â  Â  Â  Â  Â  gptResponsePopup.style.display = 'block';
Â  Â  Â  Â  Â  gptResponsePopup.classList.remove('minimized'); // ì¶•ì†Œëœ ìƒíƒœ í•´ì œ
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  gptResponsePopup.style.display = 'none';
Â  Â  Â  Â  gptResponsePopup.classList.remove('minimized');
Â  Â  Â  }
Â  Â  }

Â  Â  function autoResizeTextarea() {
Â  Â  Â  Â  this.style.height = 'auto';
Â  Â  Â  Â  this.style.height = (this.scrollHeight) + 'px';
Â  Â  }

Â  Â  document.getElementById('userInput').addEventListener('keydown', function(event) {
Â  Â  Â  Â  if (event.key === 'Enter' && !event.shiftKey) {
Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  sendChatMessage();
Â  Â  Â  Â  Â  Â  this.style.height = '40px';
Â  Â  Â  Â  }
Â  Â  });
Â  Â  document.getElementById('userInput').addEventListener('input', autoResizeTextarea);

Â  Â  document.getElementById('sendBtn').addEventListener('click', sendChatMessage);

Â  Â  function sendChatMessage() {
Â  Â  Â  const userInputElement = document.getElementById('userInput');
Â  Â  Â  const input = userInputElement.value;
Â  Â  Â  if (!input.trim()) return;

Â  Â  Â  const chatLog = document.getElementById('chatLog');

Â  Â  Â  const userMessageDiv = document.createElement('div');
Â  Â  Â  userMessageDiv.classList.add('response-box', 'user');
Â  Â  Â  userMessageDiv.innerHTML = `<strong>ì‚¬ìš©ì:</strong> ${input}`;
Â  Â  Â  chatLog.appendChild(userMessageDiv);

Â  Â  Â  let gptResponseContent = "";
Â  Â  Â  if (input.includes("ì¼ë³¸ ì—¬í–‰ ìˆœì„œë„") || input.includes("ë‹¨ê³„") || input.includes("ì‹œì‘")) {
Â  Â  Â  Â  gptResponseContent = "ë„¤, ì¼ë³¸ ì—¬í–‰ ìˆœì„œë„ëŠ” í¬ê²Œ 'ì—¬í–‰ ëª©í‘œ ë° ì˜ˆì‚° ì„¤ì • â†’ í•­ê³µê¶Œ ë° ìˆ™ì†Œ ì˜ˆì•½ â†’ ì„¸ë¶€ ì¼ì • ê³„íš ë° í˜„ì§€ ì •ë³´ ì¡°ì‚¬ â†’ ì—¬í–‰ ì¤€ë¹„ë¬¼ í™•ì¸ ë° í™˜ì „' ë“±ì˜ ë‹¨ê³„ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.";
Â  Â  Â  } else if (input.includes("ëª©í‘œ") || input.includes("ì˜ˆì‚°")) {
Â  Â  Â  Â  gptResponseContent = "ì—¬í–‰ ëª©í‘œì™€ ì˜ˆì‚° ì„¤ì •ì€ ì—¬í–‰ì˜ ëª©ì (íœ´ì‹, ê´€ê´‘ ë“±)ê³¼ ì˜ˆìƒ ì§€ì¶œ ê¸ˆì•¡ì„ ì •í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ì´ ì •ë³´ê°€ êµ¬ì²´ì ì¼ìˆ˜ë¡ ë‹¤ìŒ ë‹¨ê³„ê°€ ìˆ˜ì›”í•´ì§‘ë‹ˆë‹¤.";
Â  Â  Â  } else if (input.includes("í•­ê³µê¶Œ") || input.includes("ìˆ™ì†Œ")) {
Â  Â  Â  Â  gptResponseContent = "í•­ê³µê¶Œê³¼ ìˆ™ì†Œ ì˜ˆì•½ ì‹œì—ëŠ” ì—¬ê¶Œ ìœ íš¨ê¸°ê°„ í™•ì¸, í•­ê³µê¶Œ ìµœì €ê°€ ë¹„êµ, ìˆ™ì†Œ ìœ„ì¹˜ ë° í¸ì˜ì‹œì„¤ ê³ ë ¤ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.";
Â  Â  Â  } else if (input.includes("ì¼ì •") || input.includes("í˜„ì§€ ì •ë³´")) {
Â  Â  Â  Â  gptResponseContent = "ì„¸ë¶€ ì¼ì • ê³„íšì€ ë°©ë¬¸í•  ì¥ì†Œ, êµí†µí¸, ì‹ì‚¬ ê³„íšì„ êµ¬ì²´í™”í•˜ëŠ” ê²ƒì´ê³ , í˜„ì§€ ì •ë³´ ì¡°ì‚¬ëŠ” ë‚ ì”¨, ë¹„ìƒ ì—°ë½ì²˜, ë¬¸í™” ë“±ì„ íŒŒì•…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.";
Â  Â  Â  } else if (input.includes("ì¤€ë¹„ë¬¼") || input.includes("í™˜ì „")) {
Â  Â  Â  Â  gptResponseContent = "ì—¬í–‰ ì¤€ë¹„ë¬¼ í™•ì¸ì€ ê°œì¸ ë¬¼í’ˆ, ì˜ë¥˜, ìƒë¹„ì•½ ë“±ì„ ì ê²€í•˜ê³ , í™˜ì „ì€ ì¼ë³¸ ì—”í™”ë¡œ ë¯¸ë¦¬ ì¤€ë¹„í•˜ëŠ” ë‹¨ê³„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.";
Â  Â  Â  } else {
Â  Â  Â  Â  gptResponseContent = `'${input}'ì— ëŒ€í•œ ë‹µë³€ì…ë‹ˆë‹¤.`;
Â  Â  Â  }

Â  Â  Â  const cleanedGptResponseContent = gptResponseContent.trim().replace(/\n{2,}/g, '\n').replace(/\t/g, ' ');

Â  Â  Â  const existingLastResponse = document.getElementById('lastResponse');
Â  Â  Â  if (existingLastResponse) {
Â  Â  Â  Â  existingLastResponse.removeAttribute('id');
Â  Â  Â  }

Â  Â  Â  const gptMessageDiv = document.createElement('div');
Â  Â  Â  gptMessageDiv.classList.add('response-box', 'gpt');
Â  Â  Â  gptMessageDiv.id = 'lastResponse';
Â  Â  Â  gptMessageDiv.innerHTML = `<strong>ChatGPT:</strong> ${cleanedGptResponseContent}`; 
Â  Â  Â  chatLog.appendChild(gptMessageDiv);

Â  Â  Â  chatLog.scrollTop = chatLog.scrollHeight;
Â  Â  Â  
Â  Â  Â  userInputElement.value = '';
Â  Â  Â  userInputElement.style.height = '40px';

Â  Â  Â  if (gptResponsePopup.style.display === 'block' && !gptResponsePopup.classList.contains('minimized')) {
Â  Â  Â  Â  Â  document.getElementById('popupResponseContent').textContent = cleanedGptResponseContent; 
Â  Â  Â  }

Â  Â  Â  updateGoalSummary();
Â  Â  }

Â  Â  function updateGoalSummary() {
Â  Â  Â  Â  const chatLog = document.getElementById('chatLog');
Â  Â  Â  Â  const gptResponses = chatLog.querySelectorAll('.response-box.gpt');
Â  Â  Â  Â  let summaryText = "ì•„ì§ ìš”ì•½ëœ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.";

Â  Â  Â  Â  if (gptResponses.length > 0) {
Â  Â  Â  Â  Â  Â  summaryText = "--- ëŒ€í™” ìš”ì•½ëœ ëª©í‘œ ---\n";
Â  Â  Â  Â  Â  Â  let stepCounter = 1;
Â  Â  Â  Â  Â  Â  gptResponses.forEach((responseDiv, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const text = responseDiv.textContent.replace('ChatGPT:', '').trim();
Â  Â  Â  Â  Â  Â  Â  Â  const cleanedText = text.trim().replace(/\n{2,}/g, '\n').replace(/\t/g, ' ');

Â  Â  Â  Â  Â  Â  Â  Â  if (cleanedText.includes("ë‹¨ê³„") || cleanedText.includes("ì‹œì‘") || cleanedText.includes("ë‹¤ìŒìœ¼ë¡œ") || cleanedText.includes("ì¤‘ìš”")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summaryText += `${stepCounter}. ${cleanedText}\n`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stepCounter++;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (index === gptResponses.length -1 && stepCounter === 1) { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summaryText += `${stepCounter}. ${cleanedText}\n`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  if (stepCounter === 1 && gptResponses.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const lastCleanedText = gptResponses[gptResponses.length -1].textContent.replace('ChatGPT:', '').trim().replace(/\n{2,}/g, '\n').replace(/\t/g, ' ');
Â  Â  Â  Â  Â  Â  Â  Â  summaryText += `1. ${lastCleanedText}\n`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById('summarizedGoalContent').textContent = summaryText;
Â  Â  }


Â  Â  function exportToXML() {
Â  Â  Â  let textToExport = "";
Â  Â  Â  const lastResponseElement = document.getElementById('lastResponse');
Â  Â  Â  if (lastResponseElement) {
Â  Â  Â  Â  Â  textToExport = lastResponseElement.textContent.replace('ChatGPT:', '').trim().replace(/\n{2,}/g, '\n').replace(/\t/g, ' ');
Â  Â  Â  } else {
Â  Â  Â  Â  Â  textToExport = document.getElementById('diagramContent').textContent;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  const xmlContent = `<?xml version="1.0" encoding="UTF-8"?>\n<response>\n Â <text>${textToExport}</text>\n</response>`;
Â  Â  Â  const blob = new Blob([xmlContent], { type: 'text/xml' });
Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  a.href = url;
Â  Â  Â  a.download = 'diagram_response.xml';
Â  Â  Â  a.click();
Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  }

Â  Â  // --- íŒì—… ë“œë˜ê·¸ ê¸°ëŠ¥ ---
Â  Â  gptResponsePopup.addEventListener('mousedown', (e) => {
Â  Â  Â  if (gptResponsePopup.classList.contains('minimized')) { // ì¶•ì†Œëœ ìƒíƒœì—ì„œëŠ” ì „ì²´ê°€ ë“œë˜ê·¸ ê°€ëŠ¥
Â  Â  Â  Â  isDragging = true;
Â  Â  Â  Â  gptResponsePopup.style.zIndex = '101'; 
Â  Â  Â  Â  offsetX = e.clientX - gptResponsePopup.getBoundingClientRect().left;
Â  Â  Â  Â  offsetY = e.clientY - gptResponsePopup.getBoundingClientRect().top;
Â  Â  Â  Â  gptResponsePopup.style.cursor = 'grabbing';
Â  Â  Â  } else if (e.target.closest('.popup-header') || e.target === gptResponsePopup || e.target.closest('.popup-content')) {
Â  Â  Â  Â  isDragging = true;
Â  Â  Â  Â  gptResponsePopup.style.zIndex = '101'; 
Â  Â  Â  Â  offsetX = e.clientX - gptResponsePopup.getBoundingClientRect().left;
Â  Â  Â  Â  offsetY = e.clientY - gptResponsePopup.getBoundingClientRect().top;
Â  Â  Â  Â  gptResponsePopup.style.cursor = 'grabbing';
Â  Â  Â  }
Â  Â  });

Â  Â  document.addEventListener('mousemove', (e) => {
Â  Â  Â  if (!isDragging) return;
Â  Â  Â  const diagramRect = document.getElementById('diagram').getBoundingClientRect();
Â  Â  Â  let newLeft = e.clientX - offsetX;
Â  Â  Â  let newTop = e.clientY - offsetY;

Â  Â  Â  if (newLeft < diagramRect.left) newLeft = diagramRect.left;
Â  Â  Â  if (newLeft + gptResponsePopup.offsetWidth > diagramRect.right) {
Â  Â  Â  Â  Â  newLeft = diagramRect.right - gptResponsePopup.offsetWidth;
Â  Â  Â  }
Â  Â  Â  if (newTop < diagramRect.top) newTop = diagramRect.top;
Â  Â  Â  if (newTop + gptResponsePopup.offsetHeight > diagramRect.bottom) {
Â  Â  Â  Â  Â  newTop = diagramRect.bottom - gptResponsePopup.offsetHeight;
Â  Â  Â  }

Â  Â  Â  gptResponsePopup.style.left = `${newLeft}px`;
Â  Â  Â  gptResponsePopup.style.top = `${newTop}px`;
Â  Â  Â  gptResponsePopup.style.transform = 'none';
Â  Â  });

Â  Â  document.addEventListener('mouseup', () => {
Â  Â  Â  isDragging = false;
Â  Â  Â  gptResponsePopup.style.cursor = 'grab';
Â  Â  Â  gptResponsePopup.style.zIndex = '100'; 
Â  Â  });
Â  Â  // --- íŒì—… ë“œë˜ê·¸ ê¸°ëŠ¥ ë ---

Â  Â  // --- íŒì—… ì¶•ì†Œ/í™•ëŒ€ ê¸°ëŠ¥ ---
Â  Â  function togglePopupMinimize(event) {
Â  Â  Â  if (event) event.stopPropagation(); // ë“œë˜ê·¸ ì´ë²¤íŠ¸ì™€ ì¶©ëŒ ë°©ì§€
Â  Â  Â  const popup = document.getElementById('gptResponsePopup');
Â  Â  Â  if (popup.classList.contains('minimized')) {
Â  Â  Â  Â  popup.classList.remove('minimized');
Â  Â  Â  Â  popup.style.cursor = 'grab';
Â  Â  Â  } else {
Â  Â  Â  Â  popup.classList.add('minimized');
Â  Â  Â  Â  popup.style.cursor = 'pointer'; // ì¶•ì†Œ ì‹œ í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡
Â  Â  Â  }
Â  Â  }

Â  Â  // ì¶•ì†Œëœ ìƒíƒœì—ì„œ íŒì—…ì„ í´ë¦­í•˜ë©´ ë‹¤ì‹œ í™•ëŒ€
Â  Â  gptResponsePopup.addEventListener('click', (event) => {
Â  Â  Â  if (gptResponsePopup.classList.contains('minimized')) {
Â  Â  Â  Â  togglePopupMinimize(event);
Â  Â  Â  }
Â  Â  });
Â  Â  // --- íŒì—… ì¶•ì†Œ/í™•ëŒ€ ê¸°ëŠ¥ ë ---


Â  Â  document.addEventListener('DOMContentLoaded', updateGoalSummary);
Â  </script>
</body>
</html>